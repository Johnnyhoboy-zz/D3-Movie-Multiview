<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
   	<script type="text/javascript" src="d3.js"></script>	
    <style>
    body {
	  font: 12px sans-serif;
	}
	.tick > line {
		fill: none;
		stroke: black;
	}
	.tick > text {
		fill: black;
	}
	.selected {
		stroke: red;
		fill:red;
	}
	.selected2 {
		stroke: orange;
		fill:orange;
	}
	path.domain {
		fill: none;
		stroke-width: 2px;
		stroke: black;
	}
	#wrapper {
		clear:both;
	}
	#chart1 {
	    float:left;
	}
	#chart2{
		float:left;
	}
	#chart3 {
		float:left;
		margin-top: 30px;
		margin-left: 20px;
	}
	
	circle.brushed {
  		fill: orange;
	}
	circle.brushed1 {
  		fill: red;
	}
	circle.unmarked{
		fill: black;
	}
	circle.brushed2 {
  		fill: red;
	}
	.brush .extent {
		fill: #000;
        fill-opacity: .1;
        stroke: #fff;
	}

    </style>

   	</head>
   	<body>
   	<div id="wrapper">
   	  	<div id="info">
          	</div>
	  	<div id="chart1">
          	</div>
	  	<div id="chart2">
          	</div>
	  	<div id="chart3"> 
         	</div>
      	<div id="chart4"> 
          	</div>
      	<div id="chart5"> 
          	</div>
   	</div>
   	<script>
   		var margin = {top: 20, right: 20, bottom: 60, left: 40};

   		var width = 500;
		var height = 500;

   		var width1 = width - margin.left - margin.right;
		var height1 = height - margin.top - margin.bottom;

		var radius = (Math.min(width, height)/2 - 30);

		d3.csv("test.csv", function(csv) {

			var moviesByCountry = d3.nest()
    			.key(function(d){ 
    				return d.country;
    			})
    			.rollup(function(v){ return d3.sum(v, function(d){return 1;});})
    			.entries(csv);

			var moviesByLanguage = d3.nest()
    			.key(function(d){ 
    				return d.language;
    			})
    			.rollup(function(v){ return d3.sum(v,function(d){return 1;});})
    			.entries(csv);

    		var moviesByYear = d3.nest()
    			.key(function(d){
    				if (d.title_year != "0")
    					return d.title_year;
    				else 
    					return "Not Specified";
    			})
    			.rollup(function(v){ return d3.sum(v, function(d){return 1;});})
    			.entries(csv);


    		var colorScale = d3.scale.category10();
    		console.log('color scale range', colorScale.range());

    		var xScale = d3.scale.ordinal()
    			.domain(moviesByYear.map(d => d.key))
    			.rangePoints([0, width1], 1) 


    		var yScale = d3.scale.linear()
    			.domain([0, d3.max(moviesByYear, d => d.values) + 1])
    			.range([height1, 0])

    		var chart1 = d3.select("#chart1")
		                .append("svg:svg")
		                .attr("width",width)
		                .attr("height",height)
		               	.append("g")
		               	.attr('transform', `translate(${margin.left}, ${margin.top})`);

		    // draw bars
    		var bar1 = chart1.selectAll(".bar")
        		.data(moviesByYear)
      			.enter().append('rect')
        		.attr('class', 'bar')
        		.attr('x', d => xScale(d.key))
        		.attr('y', d => yScale(d.values))
        		.attr('height', d => height1 - yScale(d.values))
        		.attr('width', 30)
        		.attr("transform", "translate(-15, 0)")
        		.style('fill',d => colorScale(d.key));

        	var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
    		chart1.append("g")
        		.attr("class", "x axis")
        		.attr("transform", "translate(0," + height1 + ")")
        		.call(xAxis)
      		  .append("text")
        		.attr("class", "label")
        		.attr("x", width1)
        		.attr("y", 30)
        		.style("text-anchor", "end")
        		.text("Title Year");

        	// y-axis
    		var yAxis = d3.svg.axis().scale(yScale).orient("left");
    		chart1.append("g")
        		.attr("class", "y axis")
        		.attr("transform", "translate(0, 0)")
        		.call(yAxis)
      		  .append("text")
        		.attr("class", "label")
        		.text("Count")
        		.attr("transform", "translate(15, 0), rotate(-90)")
        		.style("text-anchor", "end")

        	chart1.append("text")
        		.text("Number of Movies by Year")
        		.attr("transform", "translate(" + (width1/2 - 100) + ",0)")
        		.style("font", "23px avenir")

        	var chart2 = d3.select("#chart2")
		                .append("svg:svg")
		                .attr("width",width)
		                .attr("height",height)
		               	.append("g")
		               	.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

		    var colorScale1 = d3.scale.category20c();
		    var moviesByCountryfilter = d3.nest()
    			.key(function(d){
    				if (d.values > 10) 
    				return d.key;
    				else
    				return "other";
    			})
    			.rollup(function(v){ return d3.sum(v, function(d){return d.values;});})
    			.entries(moviesByCountry);
    		console.log(JSON.stringify(moviesByCountryfilter));

		    var pie = d3.layout.pie()
		    			.value(function(d) {
		    				return d.values;
		    			});

        	var arc = d3.svg.arc()
        				.outerRadius(radius)
        				.innerRadius(0);

        	var labelArc = d3.svg.arc()
        					.outerRadius(radius - 40)
        					.innerRadius(radius - 40);

        	var g = chart2.selectAll(".arc")
        				.data(pie(moviesByCountryfilter))
        			.enter().append("g")
        				.attr("class", "arc");

        	g.append("path")
      				.attr("d", arc)
      				.style("fill", function(d) { return colorScale1(d.data.key); });

      		chart2.append("text")
        		.text("Movies by Countries")
        		.attr("transform", "translate(-80,-230)")
        		.style("font", "23px avenir")

        	var chart3 = d3.select("#chart2")
		                .append("svg:svg")
		                .attr("width",width)
		                .attr("height",height)
		               	.append("g")
		               	.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

		    var colorScale2 = d3.scale.category20();
		    var moviesByLanguagefilter = d3.nest()
    			.key(function(d){
    				if (d.values > 7) 
    				return d.key;
    				else
    				return "other";
    			})
    			.rollup(function(v){ return d3.sum(v, function(d){return d.values;});})
    			.entries(moviesByLanguage);
    		console.log(JSON.stringify(moviesByLanguagefilter));

		    var pie = d3.layout.pie()
		    			.value(function(d) {
		    				return d.values;
		    			});

        	var arc = d3.svg.arc()
        				.outerRadius(radius)
        				.innerRadius(0);

        	var labelArc = d3.svg.arc()
        					.outerRadius(radius - 40)
        					.innerRadius(radius - 40);

        	var g = chart3.selectAll(".arc")
        				.data(pie(moviesByLanguagefilter))
        			.enter().append("g")
        				.attr("class", "arc");

        	g.append("path")
      				.attr("d", arc)
      				.style("fill", function(d) { return colorScale2(d.data.key); });

      		chart3.append("text")
        		.text("Movies by Countries")
        		.attr("transform", "translate(-80,-230)")
        		.style("font", "23px avenir")


		});

   	</script>

  </body>
</html>