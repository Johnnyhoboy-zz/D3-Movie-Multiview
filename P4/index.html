<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
   <script type="text/javascript" src="d3.js"></script>	 	  
    <style>
    body {
	  font: 12px sans-serif;
	}
	.tick > line {
		fill: none;
		stroke: black;
	}
	.tick > text {
		fill: black;
	}
	.selected {
		stroke: red;
		fill:red;
	}
	.selected2 {
		stroke: orange;
		fill:orange;
	}
	path.domain {
		fill: none;
		stroke-width: 2px;
		stroke: black;
	}
	#wrapper {
		clear:both;
	}
	#chart1 {
	    float:left;
	}
	#chart2{
		float:left;
	}
	#chart3 {
		float:left;
		margin-top: 30px;
		margin-left: 20px;
	}
	
	circle.brushed {
  		fill: orange;
	}
	circle.brushed1 {
  		fill: red;
	}
	circle.unmarked{
		fill: black;
	}
	circle.brushed2 {
  		fill: red;
	}
	.brush .extent {
		fill: #000;
        fill-opacity: .1;
        stroke: #fff;
	}

    </style>

   </head>
   <body>
   <div id="wrapper">
	  <div id="chart1">
           </div>
	  <div id="chart2">
          </div>
	  <div id="chart3"> 
	  	 		
         </div>
   </div>
  <script>
   
	var width =500;
	var height= 500;

	var curACT = 0;
	var curGPA = 0;
	var curSATM = 0;
	var curSATV = 0;

    d3.csv("calvinCollegeSeniorScores.csv", function(csv) {
	    for (var i=0; i<csv.length; ++i) {
			csv[i].GPA = Number(csv[i].GPA);
			csv[i].SATM = Number(csv[i].SATM);
			csv[i].SATV = Number(csv[i].SATV);
			csv[i].ACT = Number(csv[i].ACT);
	    }
	    var satmExtent = d3.extent(csv, function(row) { return row.SATM; });
	    var satvExtent = d3.extent(csv, function(row) { return row.SATV; });
	    var actExtent = d3.extent(csv,  function(row) { return row.ACT;  });
	    var gpaExtent = d3.extent(csv,  function(row) {return row.GPA;   });    
	    
	    var satExtents = {
		"SATM": satmExtent,
		"SATV": satvExtent
	    }; 
	   

	    var xScale = d3.scale.linear().domain(satmExtent).range([50, 470]);
	    var yScale = d3.scale.linear().domain(satvExtent).range([470, 30]);
	 
	    var xScale2 = d3.scale.linear().domain(actExtent).range([50, 470]);
	    var yScale2 = d3.scale.linear().domain(gpaExtent).range([470, 30]);
	     
	    var xAxis = d3.svg.axis().scale(xScale);
	    var yAxis = d3.svg.axis().scale(yScale);
	  
	    var xAxis2 = d3.svg.axis().scale(xScale2);
	    var yAxis2 = d3.svg.axis().scale(yScale2);
	    
	    yAxis.orient("left");
	    yAxis2.orient("left");

	 
	    var chart1 = d3.select("#chart1")
		                .append("svg:svg")
		                .attr("width",width)
		                .attr("height",height);


	    var chart2 = d3.select("#chart2")
		                .append("svg:svg")
		                .attr("width",width)
		                .attr("height",height);

		var chart3 = d3.select("#chart3");

		 /******************************************
			
			ADD BRUSHING CODE HERE

		 ******************************************/

		var brush = d3.svg.brush()
            .extent([[0, 0],[width, height]]);

        brushX = d3.scale.linear().range([0, width]),
        brushY = d3.scale.linear().range([0, height]);
        brush.x(brushX).y(brushY);

        var area = chart1.append("g")
            .attr("class", "brush")
            .call(brush);

        brush
            .on("brushstart", brushstart)   // when mousedown&dragging starts 
            .on("brush", brushing)          // when dragging
            .on("brushend", brushend);      // when mouseup

        var brush2 = d3.svg.brush()
            .extent([[0, 0],[width, height]]);

        brushX2 = d3.scale.linear().range([0, width]),
        brushY2 = d3.scale.linear().range([0, height]);
        brush2.x(brushX2).y(brushY2);

        var area2 = chart2.append("g")
            .attr("class", "brush")
            .call(brush2);

        brush2
            .on("brushstart", brushstart)   // when mousedown&dragging starts 
            .on("brush", brushing2)          // when dragging
            .on("brushend", brushend);      // when mouseup


        d3.selectAll("circle")
        	.on('click', function(d,i){
        		console.log("d.ACT");
        	});

	     var temp1= chart1.selectAll("circle")
		   .data(csv)
		   .enter()
		   .append("circle")
		   .attr("id",function(d,i) {return i;} )
		   .attr("stroke", "black")
		   .attr("cx", function(d) { return xScale(d.SATM); })
		   .attr("cy", function(d) { return yScale(d.SATV); })
		   .attr("r", 5)
		   .on("click", function(d,i){ 
		   		chart1.selectAll("circle").classed("brushed2", false);
		   		curACT = d.ACT;
		   		curGPA = d.GPA;
		   		curSATV = d.SATV;
		   		curSATM = d.SATM;
		   		chart2.selectAll("circle").classed("brushed2", function(d) {
                return curACT == d.ACT&& curGPA==d.GPA
                && curSATM == d.SATM && curSATV == d.SATV;
            	});
            	updateText();
           });
	  	


	    var temp2= chart2.selectAll("circle")
		   .data(csv)
		   .enter()
		   .append("circle")
		   .attr("id",function(d,i) {return i;} )
		   .attr("stroke", "black")
		   .attr("cx", function(d) { return xScale2(d.ACT); })
		   .attr("cy", function(d) { return yScale2(d.GPA); })
		   .attr("r", 5)
		   .on("click", function(d,i){ 
		   		chart2.selectAll("circle").classed("brushed2", false);
		   		curACT = d.ACT;
		   		curGPA = d.GPA;
		   		curSATV = d.SATV;
		   		curSATM = d.SATM;
		   		chart1.selectAll("circle").classed("brushed2", function(d) {
                return curACT == d.ACT&& curGPA== d.GPA
                && curSATM == d.SATM && curSATV == d.SATV;
            	});
            	updateText();
           });
                
	    
	    chart1 // or something else that selects the SVG element in your visualizations
			.append("g") // create a group node
			.attr("transform", "translate(0,"+ (width -30)+ ")")
			.call(xAxis) // call the axis generator
			.append("text")
			.attr("class", "label")
			.attr("x", width-16)
			.attr("y", -6)
			.style("text-anchor", "end")
			.text("SATM");

	    chart1 // or something else that selects the SVG element in your visualizations
			.append("g") // create a group node
			.attr("transform", "translate(50, 0)")
			.call(yAxis)
			.append("text")
			.attr("class", "label")
			.attr("transform", "rotate(-90)")
			.attr("y", 6)
			.attr("dy", ".71em")
			.style("text-anchor", "end")
			.text("SATV");

	    chart2 // or something else that selects the SVG element in your visualizations
			.append("g") // create a group node
			.attr("transform", "translate(0,"+ (width -30)+ ")")
			.call(xAxis2)
			.append("text")
			.attr("class", "label")
			.attr("x", width-16)
			.attr("y", -6)
			.style("text-anchor", "end")
			.text("ACT");

	    chart2 // or something else that selects the SVG element in your visualizations
			.append("g") // create a group node
			.attr("transform", "translate(50, 0)")
			.call(yAxis2)
			.append("text")
			.attr("class", "label")
			.attr("transform", "rotate(-90)")
			.attr("y", 6)
			.attr("dy", ".71em")
			.style("text-anchor", "end")
			.text("GPA");

		
		chart3
			.append("text")
			.text("SATM Score : " + curSATM + " " + "SATV Score : " + curSATV + " " + "ACT Score : " + curACT + " " + "GPA : " + curGPA + " ");



		function brushstart() {
			chart1.selectAll("circle").classed("brushed1", false);
			chart1.selectAll("circle").classed("unmarked", false);
			chart2.selectAll("circle").classed("brushed", false);
			chart2.selectAll("circle").classed("unmarked", false);
        }


        function brushing() {
            // simultaneous update during brushing
            var e = brush.extent();         // coordinates of brushed area: 
                                            // top-left x: e[0][0] y: e[0][1]
                                            // bottom-right x: e[1][0] y: e[1][1]
            // change the class of node to brushed if the node is inside the brushed extent
            area2.call(brush2.clear());



            chart1.selectAll("circle").classed("unmarked", function(d) {
                return e[0][0] <= brushX.invert(xScale(d.SATM)) && brushX.invert(xScale(d.SATM)) <= e[1][0] &&
                    e[0][1] <= brushY.invert(yScale(d.SATV)) && brushY.invert(yScale(d.SATV)) <= e[1][1];
            });

            // extract the indexes of brushed elements
            brushed_ACT = chart1.selectAll("circle.unmarked").data().map(a => a.ACT);
            brushed_GPA = chart1.selectAll("circle.unmarked").data().map(a => a.GPA);
            brushed_SATM = chart1.selectAll("circle.unmarked").data().map(a => a.SATM);
            brushed_SATV = chart1.selectAll("circle.unmarked").data().map(a => a.SATV);
            
            

            // link to second svg- highlight nodes (that are brushed in svg1) in svg2
            chart2.selectAll("circle").classed("brushed", function(d) {
                return brushed_ACT.includes(d.ACT)&&brushed_GPA.includes(d.GPA)
                && brushed_SATM.includes(d.SATM) && brushed_SATV.includes(d.SATV);
            });

            



        }


        function brushing2() {
        	var e = brush2.extent();

        	area.call(brush.clear());

        	chart2.selectAll("circle").classed("unmarked", function(d) {
                return e[0][0] <= brushX2.invert(xScale2(d.ACT)) && brushX2.invert(xScale2(d.ACT)) <= e[1][0] &&
                    e[0][1] <= brushY2.invert(yScale2(d.GPA)) && brushY2.invert(yScale2(d.GPA)) <= e[1][1];
            });

        	brushed_ACT = chart2.selectAll("circle.unmarked").data().map(a => a.ACT);
            brushed_GPA = chart2.selectAll("circle.unmarked").data().map(a => a.GPA);
            brushed_SATM = chart2.selectAll("circle.unmarked").data().map(a => a.SATM);
            brushed_SATV = chart2.selectAll("circle.unmarked").data().map(a => a.SATV);

            chart1.selectAll("circle").classed("brushed1", function(d) {
                return brushed_ACT.includes(d.ACT)&&brushed_GPA.includes(d.GPA)
                && brushed_SATM.includes(d.SATM) && brushed_SATV.includes(d.SATV);
            });

            area.call(brush.clear())
            
        }

        function brushend() {
            // update after brusing is finished
        }

        function updateText() {
        	chart3.selectAll("text").remove();
        	chart3
				.append("text")
				.text("SATM Score : " + curSATM + " " + "SATV Score : " + curSATV + " " + "ACT Score : " + curACT + " " + "GPA : " + curGPA + " ");
        	
        }


        

     });


  </script>
  </body>
</html>

